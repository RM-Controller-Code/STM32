#include "Buzzer.h"


static GPIO_PinState Read_PIN;
uint8_t OK = 0;                 // 启动运行标志
/*************************
 * Buzzer_on
 * @param psc:调整频率 pwm:调整音量
 * 启动蜂鸣器
 */
void Buzzer_on(uint16_t psc,uint16_t pwm){
    htim4.Instance->PSC = psc;
    htim4.Instance->CCR3 = pwm;
}

void Buzzer_off(){
    htim4.Instance->PSC = 0;
    htim4.Instance->CCR3 = 0;
}

void Solitary_brave(){
    int16_t solitary_brave[]=
            {
                    M6,50,M7,50,H1,50,H2,50,M7,50,H1,50,H1,100,Z0,10,	//爱你孤身走暗巷
                    H1,50,M7,50,H1,50,H2,50,M7,50,H1,50,H1,100,Z0,10, 	//爱你不跪的模样
                    H1,50,H2,50,H3,50,H2,50,H3,50,H2,50,H3,100,H3,50,H3,50,H2,50,H3,100,H5,100,H3,100,Z0,10 //爱你对峙过绝望不肯哭一场

            };
    int length = sizeof(solitary_brave)/sizeof(solitary_brave[0]);

    for(uint8_t i=0;i<(length/2);i++)
    {
        if(OK == 1){
            Read_PIN = HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_0);
            if (Read_PIN == GPIO_PIN_RESET) {
                OK = 0;
                Buzzer_on(0,0);
                htim5.Instance->CCR3 = 0;
                htim5.Instance->CCR2 = 0;
                htim5.Instance->CCR1 = 0;
                HAL_Delay(3000);
                return;
            }
            Buzzer_on(solitary_brave[i * 2], 100);
            HAL_Delay(5 * solitary_brave[i * 2 + 1]);
        }
    }
    Buzzer_on(0,0);
}

void wind_rise(){
    int wind_rise[]=
            {
                    //前奏
                    L7,25,M1,25,M2,25,M3,25,L3,50,M5,25,M3,25,M3,50,Z0,150, L7,25,M1,25,M2,25,M3,25,L2,50,M5,25,M3,25,M2,25,M3,25,M1,25,M2,25,L7,25,M1,25,L5,25,Z0,25, L7,25,M1,25,M2,25,M3,25,L3,50,M5,25,M3,75,Z0,150,L7,25,M1,25,M2,25,M3,25,L2,50,M5,25,M3,25,M2,25,M3,25,M1,25,M2,25,Z0,20,
                    //这一路上走走停停 顺着少年漂流的痕迹
                    M2,50,M2,50,M1,25,M2,50,M2,50,M1,25,M2,50,M3,50,M5,50,M3,50, M2,50,M2,50,M1,25,M2,50,M2,50,M1,25,M2,25,M3,25,M2,25,M1,25,L6,100,Z0,10,
                    //迈出车站的前一刻 竟有些犹豫
                    M2,50,M2,50,M1,25,M2,50,M2,50,M1,25,M2,50,M3,50,M5,50,M3,50, M2,50,M2,50,M3,25,M2,50,M1,50,M2,100,Z0,50,
                    //不仅笑着这近乡情怯 仍无法避免
                    M2,50,M2,50,M1,25,M2,50,M2,50,M1,25,M2,50,M3,50,M5,50,M3,50, M2,50,M2,50,M3,25,M2,50,M1,50,L6,100,Z0,10,
                    //而长野的天 依旧那么暖 风吹起了从前
                    M3,25,M2,25,M1,25,M2,25,M1,100, M3,25,M2,25,M1,25,M2,25,M1,50,M1,50, M5,25,M3,25,M2,25,M1,25,M2,25,M1,100,M1,150,Z0,30,
                    //从前初识这世间 万般留恋 看着天边似在眼前 也甘愿赴汤蹈火去走它一遍
                    M1,50,M2,50,M3,50,M1,50,M6,50,M5,25,M6,25,M6,50,M6,50, M1,25,M7,50,M6,25,M7,25,M7,100,Z0,5, M7,50,M6,25,M7,25,M7,50,M3,50,H1,25,H2,25,H1,25,M7,25,M6,50,M5,50, M6,50,M5,25,M6,25,M6,25,M5,25,M6,25,M5,25,M6,50,M5,25,M2,25,M2,25,M5,50,M5,50,M3,100,M3,100,Z0,25,
                    //如今走过这世间 万般留恋 翻过岁月不同侧脸 措不及防闯入你的笑颜
                    M1,50,M2,50,M3,50,M1,50,M6,50,M5,25,M6,25,M6,50,M6,50, M1,25,M7,50,M6,25,M7,25,M7,100,Z0,5, M7,50,M6,25,M7,25,M7,50,M3,50,H1,25,H2,25,H1,25,M7,25,M6,50,M5,50, M6,50,H3,25,H3,25,H3,50,M5,50,M6,50,H3,25,H3,25,H3,25,M5,50,M6,25,M6,100,M6,100,M6,100,Z0,25,
                    //我曾难自拔于世界之大 也沉溺于其中梦话
                    H1,50,H2,50,H3,50,H6,25,H5,25,H5,50,H6,25,H5,25,H5,50,H6,25,H5,25,H5,50,H2,25,H3,25,H3,50, H6,25,H5,25,H5,50,H6,25,H5,25,H5,50,H6,25,H5,25,H5,25,H3,50,H3,50,
                    //不得真假 不做挣扎 不惧笑话
                    H2,50,H1,25,M6,25,M6,25,H1,50, M6,25,H2,25,H1,25,M6,50,M6,25,H1,50,H1,50, H3,100,H3,25,H4,25,H3,50,H3,25,H2,50,H2,50,Z0,25,
                    //我曾将青春翻涌成她 也曾指尖弹出盛夏 心之所动且就随缘去吧
                    H1,50,H2,50,H3,50,H6,25,H5,25,H5,50,H6,25,H5,25,H5,50,H6,25,H5,25,H5,50,H2,50, H3,50,H6,25,H5,25,H5,50,H6,25,H5,25,H5,50,H6,25,H5,25,H5,50,H3,50,H3,50, H2,50,H1,25,M6,25,M6,25,H3,50,H3,50, H2,50,H1,25,M6,25,M6,25,H1,50,H1,50,H1,100,H1,100,Z0,10,
                    //短短的路走走停停  也有了几分的距离
                    M2,50,M2,50,M1,25,M2,50,M2,50,M1,25,M2,50,M3,50,M5,50,M3,50, M2,50,M2,50,M1,25,M2,50,M2,50,M1,25,M2,25,M3,25,M2,25,M1,25,L6,100,Z0,10,
                    //不知抚摸的是故事还是段心情
                    M2,50,M2,50,M1,25,M2,50,M2,50,M1,25,M2,50,M3,50,M5,50,M3,50, M2,50,M2,50,M3,25,M2,50,M1,50,M2,100,Z0,50,
                    //也许期待的不过是与时间为敌
                    M2,50,M2,50,M1,25,M2,50,M2,50,M1,25,M2,50,M3,50,M5,50,M3,50, M2,50,M2,50,M3,25,M2,50,M1,50,L6,100,Z0,10,
                    //再次见到你 微凉晨光里 笑的很甜蜜
                    M3,25,M2,25,M1,25,M2,25,M1,100, M3,25,M2,25,M1,25,M2,25,M1,50,M1,50, M5,25,M3,25,M2,25,M1,25,M2,25,M1,100,M1,150,Z0,30,
                    //从前初识这世间 万般留恋 看着天边似在眼前 也甘愿赴汤蹈火去走它一遍
                    M1,50,M2,50,M3,50,M1,50,M6,50,M5,25,M6,25,M6,50,M6,50, M1,25,M7,50,M6,25,M7,25,M7,100,Z0,5, M7,50,M6,25,M7,25,M7,50,M3,50,H1,25,H2,25,H1,25,M7,25,M6,50,M5,50, M6,50,M5,25,M6,25,M6,25,M5,25,M6,25,M5,25,M6,50,M5,25,M2,25,M2,25,M5,50,M5,50,M3,100,M3,100,Z0,25,
                    //如今走过这世间 万般留恋 翻过岁月不同侧脸 措不及防闯入你的笑颜
                    M1,50,M2,50,M3,50,M1,50,M6,50,M5,25,M6,25,M6,50,M6,50, M1,25,M7,50,M6,25,M7,25,M7,100,Z0,5, M7,50,M6,25,M7,25,M7,50,M3,50,H1,25,H2,25,H1,25,M7,25,M6,50,M5,50, M6,50,H3,25,H3,25,H3,50,M5,50,M6,50,H3,25,H3,25,H3,25,M5,50,M6,25,M6,100,M6,100,M6,100,Z0,25,
                    //我曾难自拔于世界之大 也沉溺于其中梦话
                    H1,50,H2,50,H3,50,H6,25,H5,25,H5,50,H6,25,H5,25,H5,50,H6,25,H5,25,H5,50,H2,25,H3,25,H3,50, H6,25,H5,25,H5,50,H6,25,H5,25,H5,50,H6,25,H5,25,H5,25,H3,50,H3,50,
                    //不得真假 不做挣扎 不惧笑话
                    H2,50,H1,25,M6,25,M6,25,H1,50, M6,25,H2,25,H1,25,M6,50,M6,25,H1,50,H1,50, H3,100,H3,25,H4,25,H3,50,H3,25,H2,50,H2,50,Z0,25,
                    //我曾将青春翻涌成她 也曾指尖弹出盛夏 心之所动且就随缘去吧
                    H1,50,H2,50,H3,50,H6,25,H5,25,H5,50,H6,25,H5,25,H5,50,H6,25,H5,25,H5,50,H2,50, H3,50,H6,25,H5,25,H5,50,H6,25,H5,25,H5,50,H6,25,H5,25,H5,50,H3,50,H3,50, H2,50,H1,25,M6,25,M6,25,H3,50,H3,50, H2,50,H1,25,M6,25,M6,25,H1,50,H1,50,H1,100,H1,100,Z0,10,
                    //逆着光行走任风吹雨打吧
                    M6,25,H3,50,H3,50,H2,50,H1,25,M6,25,M6,25,H3,50,H2,50,H1,25,M6,25,M6,25,H1,50,H1,50,H1,50,H1,100,Z0,25,
                    //晚风吹起你鬓间的白发 抚平回忆留下的疤
                    H1,50,H2,50,H2,25,H3,50,H6,25,H5,25,H5,50,H6,25,H5,25,H5,50,H6,25,H5,25,H5,50,H2,25, H3,25,H3,50,H6,25,H5,25,H5,50,H6,25,H5,25,H5,50,H6,25,H5,25,H5,25,H3,50,H3,50,Z0,5,
                    //你的眼中明暗交杂 一笑生花 暮色遮住你蹒跚的步伐
                    H2,50,H1,25,M6,25,M6,25,H1,50,M6,25,H2,25,H1,25,M6,50,M6,50, H1,50,H1,50,H3,100,H3,25,H4,25,H3,50,H3,25,H2,50,H2,50,H1,100,H2,100,H3,100,H6,25,H5,25,H5,50,H6,25,H5,25,H5,50,H6,25,H5,25,H5,50,H2,50,
                    //走进床头藏起的画 画中的你(低着头说话)
                    H3,50,H6,25,H5,25,H5,50,H6,25,H5,25,H5,50,H6,25,H5,25,H3,100,H3,50,H2,50,H1,25,M6,25,M6,25,H3,50,H3,50,H2,50,H1,25,M6,25,M6,25,H1,100,H1,50,Z0,5,
                    //我仍 了 以爱之名你还愿意吗（衔接头有问题）
                    H1,50,H2,50,H1,50,H1,100,M6,25,H3,50,H3,50,H2,50,H1,25,H6,25,H6,25,H3,50,H3,50,H2,50,H1,25,H6,25,H6,25,H1,50,H1,50,H1,100,Z0,5
            };
    int length = sizeof(wind_rise)/sizeof(wind_rise[0]);

    for(int i=0;i<(length/2);i++)
    {
        if(OK == 1){
            Read_PIN = HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_0);
            if (Read_PIN == GPIO_PIN_RESET) {
                OK = 0;
                Buzzer_on(0,0);
                htim5.Instance->CCR3 = 0;
                htim5.Instance->CCR2 = 0;
                htim5.Instance->CCR1 = 0;
                HAL_Delay(2000);
                return;
            }
            Buzzer_on(wind_rise[i*2],100);
            HAL_Delay(wind_rise[i*2+1]*5);
        }
    }
}

void Canon(){
    int16_t Canon[]=
            {
                    // Canon乐谱
                    // (1)
                    M3,400,M2,400,M1,400,L7,400,L6,400,L5,400,L6,400,L7,400,
                    // (2)
                    M3,400,M2,400,M1,400,L7,400,M6,400,M5,400,M6,400,M7,400,
                    // (3)
                    M3,400,M2,200,M4,200,H1,400,M7,200,M5,200,M6,400,M5,200,M3,200,M4,400,M2,200,M4,200,
                    // (4)
                    H1,100,M7,100,H1,100,M3,100,M5,200,M7,200,H1,200,H3,200,H5,100,H3,100,H5,100,H6,100,H4,100,H3,100,H2,100,H4,100,H3,100,H2,100,H1,100,M7,100,M6,100,M4,100,H1,200,M7,100,M5,100,H1,100,M7,100,
                    // (5)
                    H1,100,M7,100,H1,100,M3,100,M5,200,M7,200,H1,200,H3,200,H5,200,Z0,10,H5,100,H3,100,H5,100,H6,100,H4,100,H3,100,H2,100,H4,100,H3,100,H2,100,H1,100,M7,100,M6,100,M5,100,M4,200,H1,150,M5,50,M7,100,H2,50,M5,50,
                    // (6)
                    H3,150,M5,50,H3,50,H2,50,H1,50,H2,50,H2,200,H3,50,H4,50,H3,50,H2,50,H3,50,H3,150,H1,100,M7,50,H1,50,H1,50,M7,200,M5,50,M3,50,M5,100,M6,200,M7,100,H1,100,M5,200,M3,100,M5,100,M4,200,M4,50,M6,50,H1,100,H1,150,M7,50,M7,50,H1,50,H2,50,M5,50,
                    // (7)
                    H3,150,M5,50,H3,50,H2,50,H1,50,H2,50,H2,150,H3,50,H4,50,H3,50,H2,50,H3,50,H3,150,H1,50,H1,150,M7,50,H1,50,M7,150,M5,50,M3,50,M3,150,M5,100,M6,200,M7,100,H1,100,M5,200,M3,100,M5,100,M4,200,M4,50,M6,50,H1,100,H1,150,M7,50,M7,50,H1,50,H2,50,M5,50,
                    // (8)
                    H5,100,H3,50,H4,50,H5,100,H3,50,H4,50,H5,50,M7,50,M6,50,M7,50,H1,50,H2,50,H3,50,H4,50,H3,100,H1,50,H2,50,H3,100,M3,50,M4,50,M5,50,M6,50,M5,50,M4,50,M5,50,H1,50,M7,50,H1,50,M6,100,H1,50,M7,50,M6,100,M5,50,M4,50,M5,50,M4,50,M3,50,M4,50,M5,50,M6,50,M7,50,H1,50,M6,100,H1,50,M7,50,H1,100,M7,50,H1,50,M7,50,M6,50,M7,50,H1,50,H2,50,H3,50,H4,50,H5,50,
                    // (9)
                    H5,100,H3,50,H4,50,H5,100,H3,50,H4,50,H5,50,M7,50,M6,50,M7,50,H1,50,H2,50,H3,50,H4,50,H3,100,H1,50,H2,50,H3,100,M3,50,M4,50,M5,50,M6,50,M5,50,M4,50,M5,50,H1,50,M7,50,H1,50,M6,100,H1,50,M7,50,M6,100,M5,50,M4,50,M5,50,M4,50,M3,50,M4,50,M5,50,M6,50,M7,50,H1,50,M6,100,H1,50,M7,50,H1,100,M7,50,H1,50,M7,50,M6,50,M7,50,H1,50,H2,50,H3,50,H4,50,H5,50,
                    // (10)
                    H3,100,H1,50,H2,50,H3,100,H2,50,H1,50,H2,50,M7,50,H1,50,H2,50,H3,50,H2,50,H1,50,M7,50,H1,100,M6,50,M7,50,H1,100,M1,50,M2,50,M3,50,M4,50,M3,50,M2,50,M3,50,H1,50,M7,50,H1,50,M6,100,H1,50,M7,50,M6,100,M5,50,M4,50,M5,50,M4,50,M3,50,M4,50,M5,50,M6,50,M7,50,H1,50,M6,100,H1,50,M7,50,H1,100,M7,50,M6,50,M7,50,H1,50,H2,50,H1,50,M7,50,H1,50,M6,50,M7,50,
                    // (11)
                    H1,450,Z0,600,
                    // (12)
                    Z0,100,H3,50,H4,50,H5,100,H3,100,Z0,100,H2,50,H3,50,H4,100,H2,100,Z0,100,H1,50,H2,50,H3,100,H1,100,Z0,100,H3,50,H2,50,H1,100,M7,100,Z0,100,M6,50,M7,50,H1,100,M6,100,Z0,100,M5,50,M6,50,H1,100,M5,100,Z0,100,M6,50,M7,50,H1,100,M7,50,M6,50,Z0,50,M5,50,M6,50,M7,50,H2,100,M7,100,
                    // (13)
                    Z0,100,H3,50,H4,50,H5,100,H3,100,Z0,100,H2,50,H3,50,H4,100,H2,100,Z0,100,M6,50,H1,50,H2,50,H3,100,H1,100,Z0,100,H5,50,H4,50,H3,100,H5,100,H6,100,H6,50,H5,50,H4,100,H6,100,H5,100,H5,50,H4,50,H3,100,H5,100,H6,50,H5,50,H4,50,H6,50,H5,50,H4,50,H6,50,H5,50,H7,50,H6,50,H5,100,M7,50,H1,50,H2,50,M5,50,
                    // (14)
                    M5,200,H3,50,H2,50,H1,50,H2,50,H2,150,H3,50,H3,50,H4,50,H2,50,H3,50,H2,150,H1,50,H1,100,M7,50,H1,50,M3,50,M5,50,M7,50,H1,50,H3,50,H5,50,H7,50,H1,50,H7,50,H6,50,H5,50,H4,50,H5,50,H4,50,H3,50,H2,50,H3,50,H2,50,H1,50,M7,50,H1,50,M7,50,M6,50,M5,50,M6,50,M5,50,M4,50,M5,50,M6,50,M4,40,M6,50,H1,50,M7,50,M6,50,M5,50,H1,50,H1,50,M5,50,H2,50,M5,50,
                    // (15)
                    H1,200,H3,100,H4,100,H5,100,H6,100,H5,100,H4,100,H1,200,H1,100,H2,100,H3,100,H4,100,H3,100,H2,100,M4,200,M6,50,M7,50,H1,50,H1,50,H1,50,H1,100,H1,50,H1,50,H1,50,M7,50,H1,50,M4,200,M4,50,M6,50,H1,50,H2,50,H1,50,M7,100,M7,50,M7,50,H1,50,H2,50,M5,50,
                    // (16)
                    H1,200,H3,100,H4,100,H5,100,H6,100,H5,100,H4,100,H1,200,H1,100,H2,100,H3,100,H4,100,H3,100,H2,100,M4,200,M6,50,M7,50,H1,50,H1,50,H1,50,H1,100,H1,50,H1,50,H1,50,M7,50,H1,50,M4,200,M4,50,M6,50,H1,50,H2,50,H1,50,M7,100,M7,50,M7,50,H1,50,H2,50,M5,50,
                    // (17)
                    H3,350,H2,350,H1,350,M7,350,M6,350,M5,350,M6,350,M7,350,
                    // (18)
                    H3,350,H2,350,H1,350,M7,350,M6,350,M5,350,M6,350,M7,350,M3,500

            };
    int length = sizeof(Canon)/sizeof(Canon[0]);

    for(uint8_t i=0;i<(length/2);i++)
    {
        if(OK == 1){
            Read_PIN = HAL_GPIO_ReadPin(GPIOA, GPIO_PIN_0);
            if (Read_PIN == GPIO_PIN_RESET) {
                OK = 0;
                Buzzer_on(0,0);
                htim5.Instance->CCR3 = 0;
                htim5.Instance->CCR2 = 0;
                htim5.Instance->CCR1 = 0;
                HAL_Delay(3000);
                return;
            }
            Buzzer_on(Canon[i*2],100);
            HAL_Delay(5*Canon[i*2+1]);
        }
    }
}